<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>smpair.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="band.html">band.rb</a>
          <a class="source" href="config.html">config.rb</a>
          <a class="source" href="field.html">field.rb</a>
          <a class="source" href="monkeypatch_core.html">monkeypatch_core.rb</a>
          <a class="source" href="person.html">person.rb</a>
          <a class="source" href="person_set.html">person_set.rb</a>
          <a class="source" href="smpair.html">smpair.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>smpair.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s2">&quot;open3&quot;</span>
<span class="nb">require</span> <span class="s1">&#39;./field&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;./monkeypatch_core&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>usage instructions</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">if</span> <span class="no">ARGV</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">3</span> <span class="k">then</span>
  <span class="nb">puts</span> <span class="s2">&quot;Usage: ruby smpair.rb &lt;players-file&gt; &lt;bar&gt; &lt;rounds&gt;&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot; players-file&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;path to a csv file with headers (eg. name,rating)&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot; bar&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;decimal rating threshold defining the top band&quot;</span>
  <span class="nb">puts</span> <span class="s2">&quot; rounds&quot;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;number of rounds in tournament&quot;</span>
  <span class="nb">exit</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>validate and load cmd line args</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">player_list_filepath</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="nb">abort</span> <span class="s2">&quot;Bar must be a decimal number.&quot;</span> <span class="k">unless</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">strictly_decimal?</span>
<span class="n">bar</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">to_f</span>
<span class="nb">abort</span> <span class="s2">&quot;Rounds must be an integer.&quot;</span> <span class="k">unless</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="n">strictly_integer?</span>
<span class="n">rounds</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="n">to_i</span></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>read csv player list and construct bands</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">field</span> <span class="o">=</span> <span class="no">Field</span><span class="o">.</span><span class="n">read_csv</span> <span class="n">player_list_filepath</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">bands</span> <span class="n">bar</span><span class="p">,</span> <span class="n">rounds</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>dev. output</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">puts</span>
<span class="n">field</span><span class="o">.</span><span class="n">pretty_print</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>puts &ldquo;band&rdquo;.ljust(10) + &ldquo;ratings&rdquo;.ljust(20) + &ldquo;players&rdquo;.ljust(15) + &ldquo;initial score&rdquo;
bands.each<em>with</em>index do |b,i|
  rating<em>range = b.max.rating.round(2).to</em>s + &ldquo; to &rdquo; + b.min.rating.round(2).to<em>s
  puts i.to</em>s.ljust(10) + rating<em>range.ljust(20) + b.count.to</em>s.ljust(15) + b.score.to_s
end</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>MWPM &ndash; Minimum Weight Perfect Match</p>

      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="no">Open3</span><span class="o">.</span><span class="n">popen3</span><span class="p">(</span><span class="s1">&#39;python lib/mwm/mwm.py&#39;</span><span class="p">)</span>
<span class="n">field</span><span class="o">.</span><span class="n">edges_for_mwpm</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">stdin</span><span class="o">.</span><span class="n">puts</span> <span class="n">e</span> <span class="p">}</span>
<span class="n">stdin</span><span class="o">.</span><span class="n">close</span>

<span class="nb">puts</span>
<span class="nb">puts</span> <span class="s2">&quot;Pairings:&quot;</span>
<span class="nb">puts</span> <span class="n">stdout</span><span class="o">.</span><span class="n">gets</span> <span class="k">until</span> <span class="n">stdout</span><span class="o">.</span><span class="n">eof?</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
